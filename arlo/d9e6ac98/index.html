<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"islocal.cc",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"default"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。 Dockerfile构建过程解析Dockerfile基础知识 每条保留指令都必须为大写字母且后面要跟随至少一个参数 指令按照从上到下，顺序执行 #表示注释 每条指令都会创建一个新的镜像层，并对镜像进行提交"><meta property="og:type" content="article"><meta property="og:title" content="Docker|4.Dockerfile编写"><meta property="og:url" content="http://islocal.cc/arlo/d9e6ac98/index.html"><meta property="og:site_name" content="南山草舍"><meta property="og:description" content="Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。 Dockerfile构建过程解析Dockerfile基础知识 每条保留指令都必须为大写字母且后面要跟随至少一个参数 指令按照从上到下，顺序执行 #表示注释 每条指令都会创建一个新的镜像层，并对镜像进行提交"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-02-12T02:03:15.000Z"><meta property="article:modified_time" content="2020-02-12T07:25:02.000Z"><meta property="article:author" content="南山小樵"><meta property="article:tag" content="Docker"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://islocal.cc/arlo/d9e6ac98/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Docker|4.Dockerfile编写 | 南山草舍</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">南山草舍</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">17</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">181</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">104</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://islocal.cc/arlo/d9e6ac98/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="南山小樵"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="南山草舍"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Docker|4.Dockerfile编写</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-02-12 10:03:15 / 修改时间：15:25:02" itemprop="dateCreated datePublished" datetime="2020-02-12T10:03:15+08:00">2020-02-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p><h1 id="Dockerfile构建过程解析"><a href="#Dockerfile构建过程解析" class="headerlink" title="Dockerfile构建过程解析"></a>Dockerfile构建过程解析</h1><h2 id="Dockerfile基础知识"><a href="#Dockerfile基础知识" class="headerlink" title="Dockerfile基础知识"></a>Dockerfile基础知识</h2><ul><li>每条保留指令都必须为大写字母且后面要跟随至少一个参数</li><li>指令按照从上到下，顺序执行</li><li>#表示注释</li><li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li></ul><span id="more"></span><h2 id="Docker执行Dockerfile的大概流程"><a href="#Docker执行Dockerfile的大概流程" class="headerlink" title="Docker执行Dockerfile的大概流程"></a>Docker执行Dockerfile的大概流程</h2><ul><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器做出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ul><p>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程（当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制）等等；</p><p>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行Docker镜像时，会真正开始提供服务；</p><p>Docker容器，容器是直接提供服务的。</p><h1 id="Dockerfile体系结构"><a href="#Dockerfile体系结构" class="headerlink" title="Dockerfile体系结构"></a>Dockerfile体系结构</h1><table><thead><tr><th>保留字指令</th><th>含义</th></tr></thead><tbody><tr><td>FROM</td><td>基础镜像，当前新镜像是基于哪个镜像的</td></tr><tr><td>MAINTAINER</td><td>镜像维护者的姓名和邮箱地址</td></tr><tr><td>RUN</td><td>容器构建时需要运行的指令</td></tr><tr><td>EXPOSE</td><td>容器对外暴漏的端口</td></tr><tr><td>WORKDIR</td><td>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</td></tr><tr><td>ENV</td><td>在构建镜像过程中设置环境变量</td></tr><tr><td>ADD</td><td>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</td></tr><tr><td>COPY</td><td>类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中的&lt;原路径&gt;的文件&#x2F;目标复制到新的一层的镜像内的&lt;目标路径&gt;位置</td></tr><tr><td>VOLUME</td><td>容器数据卷，用于数据保存和持久化工作</td></tr><tr><td>CMD</td><td>指定一个容器启动时要运行的命令。Dockfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换（替换）</td></tr><tr><td>ENTRYPOINT</td><td>指定一个容器启动时要运行的命令。ENTRYPOINT的目标和CMD一样，都是在指定容器启动程序及参数（追加）</td></tr><tr><td>ONBUILD</td><td>当构建一个被继承的Dockerfile时运行命令，父镜像在被子镜像继承后父镜像的onbuild被触发。</td></tr></tbody></table><h1 id="编写tomcat-dockerfile"><a href="#编写tomcat-dockerfile" class="headerlink" title="编写tomcat dockerfile"></a>编写tomcat dockerfile</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]# pwd</span><br><span class="line">/root/mydocker/tomcat</span><br><span class="line">[root@localhost tomcat]# ls -l</span><br><span class="line">total 199896</span><br><span class="line">-rw-r--r-- 1 root root   9584807 Jul  6  2018 apache-tomcat-8.5.32.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root         5 Feb 13 00:15 c.txt</span><br><span class="line">-rw-r--r-- 1 root root       614 Feb 13 00:21 dockerfile</span><br><span class="line">-rw-r--r-- 1 root root 195094741 Oct 31 15:00 jdk-8u221-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]# cat /root/mydocker/tomcat/dockerfile </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER arlo&lt;10887272@qq.com&gt;</span><br><span class="line">WORKDIR /usr/local</span><br><span class="line">#安装vim,lsof软件</span><br><span class="line">RUN yum -y install vim lsof</span><br><span class="line">#拷贝并解压jdk,tomcat</span><br><span class="line">COPY c.txt /usr/local/ctext.txt</span><br><span class="line">ADD jdk-8u221-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-8.5.32.tar.gz /usr/local/</span><br><span class="line">#配置环境变量</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_221/</span><br><span class="line">ENV CLASSPATH .:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.32</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.32</span><br><span class="line">ENV PATH $JAVA_HOME/bin:$PATH</span><br><span class="line">#暴漏容器服务端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line">#启动服务</span><br><span class="line">CMD [&quot;/usr/local/apache-tomcat-8.5.32/bin/catalina.sh&quot;,&quot;run&quot;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]# docker build -f /root/mydocker/tomcat/dockerfile -t test/tomcat .</span><br><span class="line">Sending build context to Docker daemon  204.7MB</span><br><span class="line">Step 1/14 : FROM centos</span><br><span class="line"> ---&gt; 470671670cac</span><br><span class="line">Step 2/14 : MAINTAINER arlo&lt;10887272@qq.com&gt;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9fe35c7393cf</span><br><span class="line">Step 3/14 : WORKDIR /usr/local</span><br><span class="line"> ---&gt; Running in 32918030b909</span><br><span class="line">Removing intermediate container 32918030b909</span><br><span class="line"> ---&gt; d3d46c9c0512</span><br><span class="line">Step 4/14 : RUN yum -y install vim lsof</span><br><span class="line"> ---&gt; Running in 897a79906fc7</span><br><span class="line">CentOS-8 - AppStream                            251 kB/s | 6.4 MB     00:26    </span><br><span class="line">CentOS-8 - Base                                 1.3 MB/s | 5.0 MB     00:03    </span><br><span class="line">CentOS-8 - Extras                               907  B/s | 2.1 kB     00:02    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-13.el8         AppStream      1.4 M</span><br><span class="line"> lsof                x86_64      4.91-2.el8                BaseOS         253 k</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-15.el8             AppStream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-13.el8         AppStream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-13.el8         AppStream       48 k</span><br><span class="line"> which               x86_64      2.21-10.el8               BaseOS          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  6 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 8.1 M</span><br><span class="line">Installed size: 31 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/6): gpm-libs-1.20.7-15.el8.x86_64.rpm        212 kB/s |  39 kB     00:00    </span><br><span class="line">(2/6): vim-filesystem-8.0.1763-13.el8.noarch.rp 961 kB/s |  48 kB     00:00    </span><br><span class="line">(3/6): lsof-4.91-2.el8.x86_64.rpm               530 kB/s | 253 kB     00:00    </span><br><span class="line">(4/6): which-2.21-10.el8.x86_64.rpm             918 kB/s |  49 kB     00:00    </span><br><span class="line">(5/6): vim-common-8.0.1763-13.el8.x86_64.rpm    2.5 MB/s | 6.3 MB     00:02    </span><br><span class="line">(6/6): vim-enhanced-8.0.1763-13.el8.x86_64.rpm  538 kB/s | 1.4 MB     00:02    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           2.0 MB/s | 8.1 MB     00:03     </span><br><span class="line">warning: /var/cache/dnf/AppStream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS-8 - AppStream                            1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-10.el8.x86_64                               1/6 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-13.el8.noarch                2/6 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-13.el8.x86_64                    3/6 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/6 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/6 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-13.el8.x86_64                  5/6 </span><br><span class="line">  Installing       : lsof-4.91-2.el8.x86_64                                 6/6 </span><br><span class="line">  Running scriptlet: lsof-4.91-2.el8.x86_64                                 6/6 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-13.el8.x86_64                    6/6 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/6 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-13.el8.x86_64                    2/6 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-13.el8.x86_64                  3/6 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-13.el8.noarch                4/6 </span><br><span class="line">  Verifying        : lsof-4.91-2.el8.x86_64                                 5/6 </span><br><span class="line">  Verifying        : which-2.21-10.el8.x86_64                               6/6 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  vim-enhanced-2:8.0.1763-13.el8.x86_64    lsof-4.91-2.el8.x86_64              </span><br><span class="line">  gpm-libs-1.20.7-15.el8.x86_64            vim-common-2:8.0.1763-13.el8.x86_64 </span><br><span class="line">  vim-filesystem-2:8.0.1763-13.el8.noarch  which-2.21-10.el8.x86_64            </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 897a79906fc7</span><br><span class="line"> ---&gt; 13121fca3153</span><br><span class="line">Step 5/14 : COPY c.txt /usr/local/ctext.txt</span><br><span class="line"> ---&gt; 295b1db8995d</span><br><span class="line">Step 6/14 : ADD jdk-8u221-linux-x64.tar.gz /usr/local/</span><br><span class="line"> ---&gt; 8f55fab3cee8</span><br><span class="line">Step 7/14 : ADD apache-tomcat-8.5.32.tar.gz /usr/local/</span><br><span class="line"> ---&gt; 19390cab29cb</span><br><span class="line">Step 8/14 : ENV JAVA_HOME /usr/local/jdk1.8.0_221/</span><br><span class="line"> ---&gt; Running in d7db7c594c17</span><br><span class="line">Removing intermediate container d7db7c594c17</span><br><span class="line"> ---&gt; 0e316b643b87</span><br><span class="line">Step 9/14 : ENV CLASSPATH .:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</span><br><span class="line"> ---&gt; Running in fb8be4c72efe</span><br><span class="line">Removing intermediate container fb8be4c72efe</span><br><span class="line"> ---&gt; 9b2d22114da9</span><br><span class="line">Step 10/14 : ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.32</span><br><span class="line"> ---&gt; Running in 0026d43d76ef</span><br><span class="line">Removing intermediate container 0026d43d76ef</span><br><span class="line"> ---&gt; 1780fa4f640e</span><br><span class="line">Step 11/14 : ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.32</span><br><span class="line"> ---&gt; Running in 2c843fa05104</span><br><span class="line">Removing intermediate container 2c843fa05104</span><br><span class="line"> ---&gt; b3e0da022f22</span><br><span class="line">Step 12/14 : ENV PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"> ---&gt; Running in 7366d7cb77a1</span><br><span class="line">Removing intermediate container 7366d7cb77a1</span><br><span class="line"> ---&gt; afefbc99ba9c</span><br><span class="line">Step 13/14 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running in a65838b19573</span><br><span class="line">Removing intermediate container a65838b19573</span><br><span class="line"> ---&gt; cf9fbf0a77e9</span><br><span class="line">Step 14/14 : CMD [&quot;/usr/local/apache-tomcat-8.5.32/bin/startup.sh&quot;,&quot;run&quot;]</span><br><span class="line"> ---&gt; Running in 51d8114e1305</span><br><span class="line">Removing intermediate container 51d8114e1305</span><br><span class="line"> ---&gt; fd478a528ca4</span><br><span class="line">Successfully built fd478a528ca4</span><br><span class="line">Successfully tagged test/tomcat:latest</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">test/tomcat         latest              fd478a528ca4        32 seconds ago      721MB</span><br><span class="line">test/centos2        latest              9c47c178eb61        3 hours ago         314MB</span><br><span class="line">test/centos         latest              c8ed8caf62e2        17 hours ago        237MB</span><br><span class="line">tomcat              latest              b56d8850aed5        5 days ago          529MB</span><br><span class="line">centos              latest              470671670cac        3 weeks ago         237MB</span><br><span class="line">[root@localhost tomcat]# docker history test/tomcat</span><br><span class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</span><br><span class="line">fd478a528ca4        42 seconds ago       /bin/sh -c #(nop)  CMD [&quot;/usr/local/apache-t…   0B                  </span><br><span class="line">cf9fbf0a77e9        46 seconds ago       /bin/sh -c #(nop)  EXPOSE 8080                  0B                  </span><br><span class="line">afefbc99ba9c        49 seconds ago       /bin/sh -c #(nop)  ENV PATH=/usr/local/jdk1.…   0B                  </span><br><span class="line">b3e0da022f22        53 seconds ago       /bin/sh -c #(nop)  ENV CATALINA_BASE=/usr/lo…   0B                  </span><br><span class="line">1780fa4f640e        57 seconds ago       /bin/sh -c #(nop)  ENV CATALINA_HOME=/usr/lo…   0B                  </span><br><span class="line">9b2d22114da9        About a minute ago   /bin/sh -c #(nop)  ENV CLASSPATH=.:/usr/loca…   0B                  </span><br><span class="line">0e316b643b87        About a minute ago   /bin/sh -c #(nop)  ENV JAVA_HOME=/usr/local/…   0B                  </span><br><span class="line">19390cab29cb        About a minute ago   /bin/sh -c #(nop) ADD file:047cf33d1eac02dd1…   13.6MB              </span><br><span class="line">8f55fab3cee8        About a minute ago   /bin/sh -c #(nop) ADD file:cd29f38ce9a4a50a3…   407MB               </span><br><span class="line">295b1db8995d        About a minute ago   /bin/sh -c #(nop) COPY file:ba9516c02edf6166…   5B                  </span><br><span class="line">13121fca3153        About a minute ago   /bin/sh -c yum -y install vim lsof              63.6MB              </span><br><span class="line">d3d46c9c0512        2 minutes ago        /bin/sh -c #(nop) WORKDIR /usr/local            0B                  </span><br><span class="line">9fe35c7393cf        3 hours ago          /bin/sh -c #(nop)  MAINTAINER arlo&lt;10887272@…   0B                  </span><br><span class="line">470671670cac        3 weeks ago          /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class="line">&lt;missing&gt;           3 weeks ago          /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class="line">&lt;missing&gt;           4 weeks ago          /bin/sh -c #(nop) ADD file:aa54047c80ba30064…   237MB</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]# docker run -d -p 8888:8080 --name tomcat0212 -v /data/tomcatwar:/usr/local/apache-tomcat-8.5.32/webapps -v /data/tomcatlogs:/usr/local/apache-tomcat-8.5.32/logs --privileged=true test/tomcat</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Docker/" rel="tag"># Docker</a></div><div class="post-nav"><div class="post-nav-item"><a href="/arlo/a27711a4/" rel="prev" title="Docker|3.文件、数据共享"><i class="fa fa-chevron-left"></i> Docker|3.文件、数据共享</a></div><div class="post-nav-item"><a href="/arlo/bd0ffc81/" rel="next" title="处理Oracle故障：error=27072 txt: 'Linux-x86_64 Error: 5: Input/output error">处理Oracle故障：error=27072 txt: 'Linux-x86_64 Error: 5: Input/output error <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="nav-number">1.</span> <span class="nav-text">Dockerfile构建过程解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">1.1.</span> <span class="nav-text">Dockerfile基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E6%89%A7%E8%A1%8CDockerfile%E7%9A%84%E5%A4%A7%E6%A6%82%E6%B5%81%E7%A8%8B"><span class="nav-number">1.2.</span> <span class="nav-text">Docker执行Dockerfile的大概流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dockerfile%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">Dockerfile体系结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E5%86%99tomcat-dockerfile"><span class="nav-number">3.</span> <span class="nav-text">编写tomcat dockerfile</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="南山小樵" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">南山小樵</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">181</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">104</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">南山小樵</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>